<!-- Page Header -->
<div class="page-header">
  <h1>Cart</h1>
</div>

<!-- Main Content -->
<div class="cart-layout">
<!-- Stripe Payment Modal -->
<div class="modal-overlay" *ngIf="showStripeModal" (click)="closeStripeModal()">
  <div class="stripe-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="bi bi-credit-card me-2"></i>Payment Details</h3>
      <button class="btn-close" (click)="closeStripeModal()">
        <i class="bi bi-x"></i>
      </button>
    </div>

    <div class="modal-body">
      <!-- Payment Form -->
      <div class="payment-form">
        <div class="form-group">
          <label class="form-label">Cardholder Name</label>
          <input 
            type="text" 
            class="form-control" 
            [(ngModel)]="stripeForm.cardholderName"
            placeholder="John Doe">
        </div>

        <div class="form-group">
          <label class="form-label">Card Number</label>
          <input 
            type="text" 
            class="form-control" 
            [value]="stripeForm.cardNumber"
            (input)="formatCardNumber($event)"
            placeholder="1234 5678 9012 3456"
            maxlength="19">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Expiry Date</label>
            <input 
              type="text" 
              class="form-control" 
              [value]="stripeForm.expiryDate"
              (input)="formatExpiryDate($event)"
              placeholder="MM/YY"
              maxlength="5">
          </div>
          <div class="form-group">
            <label class="form-label">CVV</label>
            <input 
              type="text" 
              class="form-control" 
              [(ngModel)]="stripeForm.cvv"
              placeholder="123"
              maxlength="3">
          </div>
        </div>
      </div>

      <!-- Order Summary Recap -->
      <div class="order-recap">
        <h4>Order Summary</h4>
        <div class="recap-items">
          <div class="recap-item">
            <span>Subtotal:</span>
            <span>£{{ getSubtotal().toFixed(2) }}</span>
          </div>
          <div class="recap-item">
            <span>Shipping:</span>
            <span>£{{ getShippingCost().toFixed(2) }}</span>
          </div>
          <div class="recap-item total">
            <span>Total:</span>
            <span>£{{ getTotal().toFixed(2) }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-outline-secondary" (click)="closeStripeModal()">
        <i class="bi bi-x-circle me-2"></i>Cancel
      </button>
      <button 
        class="btn btn-success" 
        [disabled]="!isStripeFormValid()"
        (click)="processPayment()">
        <i class="bi bi-check-circle me-2"></i>Complete Payment
      </button>
    </div>
  </div>
</div>

<!-- Payment Success Modal -->
<div class="modal-overlay" *ngIf="showSuccessModal" (click)="closeSuccessModal()">
  <div class="success-modal" (click)="$event.stopPropagation()">
    <div class="modal-body">
      <div class="success-content">
        <div class="success-icon">
          <i class="bi bi-check-circle-fill"></i>
        </div>
        <h2>Payment Successful</h2>
        <p>Your order has been placed successfully</p>

        <div class="order-summary-box">
          <h4>Order Details</h4>
          <div class="order-details">
            <div class="detail-item">
              <span class="label">Order Reference:</span>
              <span class="value monospace">{{ orderReference }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Total Prescriptions:</span>
              <span class="value">{{ pendingPrescriptions.length }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Total Amount:</span>
              <span class="value">£{{ getTotal().toFixed(2) }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Payment Method:</span>
              <span class="value">Credit Card</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-outline-dark" (click)="downloadInvoice()">
        <i class="bi bi-download me-2"></i>Download Invoice
      </button>
      <button class="btn btn-primary" (click)="viewOrders()">
        <i class="bi bi-list-ul me-2"></i>View Orders
      </button>
    </div>
  </div>
</div>